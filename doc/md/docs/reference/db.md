[Главная](/) ::
[Начало](/docs/start.html) ::
[Справочник](/docs/reference.html) ::
[Учебник](/docs/tutorial.html) ::
[Системное api](/docs/api.html) ::
[Скачать](https://github.com/kshamiev/sungora)

# БД (системная библиотека)
***

Работа с БД.

Непосредственная работа с БД. Выполнение запросов.
Работа с БД в парадигме ORM.
Работа с БД в фоновом режиме. Отдельная параллельная программа.

#### Реализация

Работа с БД реализовывается через интерфейс.
Что позволяет прозрачно работать с любой конкретной БД реализованной в проекте.

Интерфейс описывает два типа методов:
- Методы непосредственной работы с БД
	- Query (Пользовательский запрос на обновление в БД)
	- QueryByte (Пользовательский запрос на обновление в БД (как правило из файлов))
	- Free (Освобождение коннекта)
- Методы работы с БД в парадигме ОРМ
	- Select (Загрузка одного объекта (записи) из БД)
	- SelectMap (Загрузка объектов (записей) из БД в хеш)
	- SelectSlice (Загрузка объектов (записей) из БД в срез)
	- SelectData (Загрузка БД в память)
	- Insert (Сохранение объекта (записи) в БД)
	- Update (Изменение объекта (записи) в БД)
	- CallFunc (Выполнение функций)
	- CallExec (Выполнение хранимых процедур)
 
#### Запросы
Для удобства работы с библиотекой реализовано два механизма работы с запросами.

#### 1 QUB (query builder)
С помощью определенных методов ранее созданного объета QUB возможно создание нативных запросов к БД.

Этот механизм реализован в простейшем виде для БД mysql.
Хотя реализован удачный метод по работе со сценариями типов.

Мне (основному разработчику) интересен второй подход работы с запросами.
Поэтому данный вариант ждет своего разработчика или будет доработан по остаточному принципу.

#### 2 База запросов

(На данный момент реализовано только для mysql)</br>

**2.1 система хранения и получение запросов по индексам**

Запросы к БД хранятся в файлах с расширением `sql`.

Сами файлы храняться по пути: `app/[moduleName]/query/[dbType]/[fileName].sql`</br>
Пример: `app/base/query/mysql/controllers.sql`

Запросы между собой разделяются по стандарту sql символом **(;)**

В момент инициализации приложения система читает все каталоги `query/dbType` всех существующих модулей.</br>
И сохраняет все найденные запросы во всех найденных файлах в соотвествующих хранилищах для каждой БД по типу соответственно. Запросы внутри каждого файла разделяются между собой символом **(;)**</br>
Запросы сохраняются под индексами соответсвующими маске: `moduleName/fileName/NumberQuery`</br>
Пример для запроса в `app/base/query/mysql/users.sql`</br>

	-- 2 обновление онлайн статуса пользователя
	UPDATE Users SET `DateOnline` = ?, `Token` = ? WHERE Id = ?;

	индекс для этого запроса будет: base/users/2

Нумерация запросов (последний элемент индекса) на данный момент неупрявляем.
И формиркуется на основание как есть. То есть в каком порядке запросы написаны в файле в таком порядке они и будут пронумерованы.

**2.2 формат запросов**

На месте где должны быть вставлены действиельные значения параметров запроса пишуться знаки вопроса (?). Пример:
	
	SELECT * FROM TableName WHERE Email LIKE ? OR Id = ?;

В остальном вся мощь sql синтаксиса Вам в помощь.

Для удобства визуального разделения и идентификации настоятельно рекомендуется комментировать каждый запрос с указанием порядкового номера. Пример:

	-- 2 обновление онлайн статуса пользователя
	UPDATE Users SET `DateOnline` = ?, `Token` = ? WHERE Id = ?;

